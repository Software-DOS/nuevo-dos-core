<main class="container-main">
  <div class="subcategory-nav" id="categoriaTabs">
    <div class="subcategory-link" [class.active]="activeTab === 'curso'" (click)="setActiveTab('curso')">En Curso</div>
    <div class="subcategory-link" [class.active]="activeTab === 'solicitadas'" (click)="setActiveTab('solicitadas')">Solicitadas</div>
    <div class="subcategory-link" [class.active]="activeTab === 'disponible'" (click)="setActiveTab('disponible')">Disponibles</div>
  </div>

  <!-- EN CURSO -->
  <div id="curso" class="subcategory-section" [class.active]="activeTab === 'curso'">
    <div class="cap-table">
      <div class="cap-header">
        <div class="empleado-row">Empleado</div>
        <div>Nombre</div>
        <div>Duración (h)</div>
        <div>Fecha Inicio</div>
        <div>Certificación</div>
        <div>Progreso</div>
      </div>
      
      <div class="cap-row" *ngFor="let capacitacion of capacitacionesEnCurso">
        <div class="empleado-info-column">
          <img [src]="capacitacion.empleado.photo" [alt]="capacitacion.empleado.nombre" class="employee-photo">
          <span>{{ capacitacion.empleado.nombre }}</span>
        </div>          
        <div>{{ capacitacion.nombre }}</div>
        <div>{{ capacitacion.duracion }}</div>
        <div>{{ capacitacion.fechaInicio }}</div>
        <div>{{ capacitacion.certificacion }}</div>
        <div>
          <svg width="80" height="50" viewBox="0 0 100 50">
            <defs>
              <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" class="base" />
                <stop offset="100%" class="progreso" />
              </linearGradient>
            </defs>
            <!-- Fondo del gauge -->
            <path d="M10 50 A40 40 0 0 1 90 50" fill="none" stroke="#eee" stroke-width="10"/>
            <!-- Progreso 70% - using exact same path as original -->
            <path d="M10 50 A40 40 0 0 1 75 21" fill="none" stroke="url(#grad)" stroke-width="10"/>
            <!-- Texto encima del centro -->
            <text x="50" y="35" text-anchor="middle" fill="#000" font-size="10" font-weight="bold">{{ capacitacion.progreso }}%</text>
          </svg>
        </div>          
      </div>
    </div>
  </div>

  <!-- DISPONIBLES -->
  <div id="disponible" class="subcategory-section" [class.active]="activeTab === 'disponible'">
    <div class="cap-table">
      <div class="cap-header">
        <div>Nombre</div>
        <div>Duración (h)</div>
        <div>Certificación</div>
        <div></div>
      </div>

      <!-- Capacitaciones estáticas -->
      <div class="cap-row" *ngFor="let capacitacion of capacitacionesDisponibles">
        <div>{{ capacitacion.nombre }}</div>
        <div>{{ capacitacion.duracion }}</div>
        <div>{{ capacitacion.certificacion }}</div>
        <div class="text-right">
          <button class="btn-eliminar" (click)="confirmarEliminacion(capacitacion)" *ngIf="!capacitacion.isStatic">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Botón para mostrar formulario -->
    <div class="text-right mb-2">
      <button id="mostrarFormularioBtn" class="nav-button" (click)="mostrarFormulario()" [style.display]="showFormButton ? 'inline-block' : 'none'">Añadir Capacitación</button>
    </div>

    <!-- Formulario emergente oculto inicialmente -->
    <div id="formularioSolicitud" class="popup-form" [style.display]="showForm ? 'block' : 'none'">
      <h3 class="h3-dark mb-2">Formulario de Solicitud</h3>
      <form id="solicitudForm" class="cv-form" (ngSubmit)="onSubmitForm($event)">
        <div class="form-group">
          <label for="nombre">Nombre de la Capacitación</label>
          <input type="text" [value]="nuevaCapacitacion.nombre" (input)="nuevaCapacitacion.nombre = $any($event.target).value" required>
        </div>
        <div class="form-group">
          <label for="duracion">Duración Estimada (horas)</label>
          <input type="number" [value]="nuevaCapacitacion.duracion" (input)="nuevaCapacitacion.duracion = +$any($event.target).value" min="1" required>
        </div>
        <div class="form-group">
          <label for="certificacion">Certificación Esperada</label>
          <input type="text" [value]="nuevaCapacitacion.certificacion" (input)="nuevaCapacitacion.certificacion = $any($event.target).value">
        </div>
        <div class="form-group">
          <label for="justificacion">Justificación</label>
          <textarea [value]="nuevaCapacitacion.justificacion" (input)="nuevaCapacitacion.justificacion = $any($event.target).value" rows="4"></textarea>
        </div>
        <div class="form-group">
          <label for="enlace">Enlace a la Certificación</label>
          <input type="text" [value]="nuevaCapacitacion.enlace" (input)="nuevaCapacitacion.enlace = $any($event.target).value">
        </div>
        <div class="edit-controls">
          <button type="submit" class="nav-button">Añadir</button>
          <button type="button" class="nav-button gray" (click)="cancelarFormulario()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Solicitadas -->
  <div id="solicitadas" class="subcategory-section" [class.active]="activeTab === 'solicitadas'">
    <div class="cap-table">
      <div class="cap-header">
        <div class="empleado-row">Empleado</div>
        <div>Departamento</div>
        <div>Nombre</div>
        <div>Duración (h)</div>
        <div>Certificación</div>
      </div>

      <div class="cap-row" *ngFor="let capacitacion of capacitacionesSolicitadas">
        <div class="empleado-info-column">
          <img [src]="capacitacion.empleado.photo" [alt]="capacitacion.empleado.nombre" class="employee-photo">
          <span>{{ capacitacion.empleado.nombre }}</span>
        </div>  
        <div>{{ capacitacion.departamento }}</div>
        <div>{{ capacitacion.nombre }}</div>
        <div>{{ capacitacion.duracion }}</div>
        <div>{{ capacitacion.certificacion }}</div>
      </div>
    </div>
  </div>
</main>
